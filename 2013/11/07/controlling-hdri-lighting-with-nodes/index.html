<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Basic Page Needs
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta charset="utf-8">

  
  <title>Controlling HDRI Lighting with Nodes</title>
  <link rel="canonical" href="http://bensimonds.com/2013/11/07/controlling-hdri-lighting-with-nodes/">
  
  <meta name="description" content="I’ve seen a couple of posts recently on getting more control over HDR based lighting setups, specifically in terms of getting crisper shadows. In part">
  
  
  <meta name="author" content="Ben Simonds">
  
  <meta property="og:image" content="http://bensimonds.comundefined">
  
  <meta property="og:site_name" content="Ben Simonds&#39; Personal Blog" />
  <meta property="og:type" content="article" />
  <meta property="og:title" content="Controlling HDRI Lighting with Nodes" />
  
  <meta property="og:description" content="I’ve seen a couple of posts recently on getting more control over HDR based lighting setups, specifically in terms of getting crisper shadows. In part">
  
  <meta property="og:url" content="http://bensimonds.com/2013/11/07/controlling-hdri-lighting-with-nodes/" />

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Controlling HDRI Lighting with Nodes">
  
  <meta name="twitter:description" content="I’ve seen a couple of posts recently on getting more control over HDR based lighting setups, specifically in terms of getting crisper shadows. In part">
  
  
  <meta name="twitter:image" content="http://bensimonds.comundefined">
  
  <meta name="twitter:url" content="http://bensimonds.com/2013/11/07/controlling-hdri-lighting-with-nodes/" />

  <!-- Mobile Specific Metas
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- CSS
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  
<link rel="stylesheet" href="/css/reset.css">

  
<link rel="stylesheet" href="/css/base.css">

  
  <!-- Favicon
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="icon" type="image/png" href="/images/favicon.png">

<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div class="container">

    <header>
  <!-- Title -->
  <div style="display:flex; flex-wrap: wrap; flex-direction:row; width: 100%; align-items: baseline; margin-bottom: -20px;">
    <h1 style="margin-bottom: 0px;">
      <a tyle="text-decoration: none;">
        BenSimonds.com
      </a>
    </h1>
    <a style=" margin-left: auto; font-size: 0.8rem;" id="siteBannerLink" href="/2011/10/13/abandoned-power-station/">Abandoned Power Station</a>
  </div>
  <!-- Site Banner Image -->

  <a href="/">
    <img id="siteBanner" class="banner" src="/images/banner-warehouse-1.png" />
  </a>

  <script>
    var banners = [
      { imgUrl: "/images/banner-fractal.png", title: "Fun with Instancing In Cycles", url: "/2012/07/04/fun-with-instancing-in-cycles/" },
      { imgUrl: "/images/banner-temple.png", title: "Blender Masterclass", url: "/2013/01/04/blender-master-class-a-hands-on-guide-to-modeling-sculpting-materials-and-rendering/" },
      { imgUrl: "/images/banner-spiderbot.png", title: "Blender Masterclass", url: "/2013/01/04/blender-master-class-a-hands-on-guide-to-modeling-sculpting-materials-and-rendering/" },
      { imgUrl: "/images/banner-pirate.jpg", title: "Blending Life 2010", url: "/2010/02/24/blending-life-2010" },
      { imgUrl: "/images/banner-warehouse-3.png", title: "Abandoned Power Station", url: "/2011/10/13/abandoned-power-station/" },
      { imgUrl: "/images/banner-warehouse-2.png", title: "Abandoned Power Station", url: "/2011/10/13/abandoned-power-station/" },
      { imgUrl: "/images/banner-warehouse-1.png", title: "Abandoned Power Station", url: "/2011/10/13/abandoned-power-station/" },
      { imgUrl: "/images/banner-circle-packing.png", title: "Mitchell's Best Candidate Algorithm", url: "/2023/02/22/circle-packing/" },
      { imgUrl: "/images/banner-perlin-snakes.png", title: "Perlin Snakes", url: "/2023/02/19/perlin-snakes/" },
      { imgUrl: "/images/banner-kumiko.svg", title: "Kumiko Grids", url: "/2023/02/28/kumiko-grids/" },
    ];
    var randomNum = Math.floor(Math.random() * banners.length);
    document.getElementById("siteBanner").src = banners[randomNum].imgUrl;
    document.getElementById("siteBannerLink").href = banners[randomNum].url;
    document.getElementById("siteBannerLink").textContent = banners[randomNum].title;

  </script>

  <!-- Navbar -->
  <nav>
    <ul>
      <li><a href="/">Home</a></li>
      
        <li><a href="/blender">Blender</a></li>
        
    </ul>
  </nav>
  <hr />
</header>


    


    <h2>Controlling HDRI Lighting with Nodes</h2>
  
  
  <p>I’ve seen a couple of posts recently on getting more control over HDR based lighting setups, specifically in terms of getting crisper shadows. In particular <a target="_blank" rel="noopener" href="http://reynantem.blogspot.co.uk/2013/07/proper-hdr-lighting-remix.html">Reyante Martinez</a> and <a target="_blank" rel="noopener" href="http://adaptivesamples.com/2013/07/24/cif-2-hdr-lighting/">Greg Zaal</a> each posted some great setups that used the colour of an HDRI map as the input to the strength node of a background shader. I thought I’d add my own experiments to the mix. Here’s a basic world setup for cycles. Just a HDR map plugged into a background node. No other lights in the scene.</p>
<p><a href="/images/old/hdri_1_basic1.png"><img src="/images/old/hdri_1_basic1.png?w=950" alt="HDRI_1_Basic &gt;&lt;"></a></p>
<p> Here’s a setup based on one that Greg posted in his original article. It gives stronger shadows by plugging the HDRI map into both the colour and intensity inputs of the background node.</p>
<p><a href="/images/old/hdri_1_isquared.png"><img src="/images/old/hdri_1_isquared.png?w=950" alt="HDRI_1_ISquared &gt;&lt;"></a></p>
<p> Of course there are many ways to achieve this sort of effect, and so the answer becomes which is the most effective, and which gives you the most control. The setup above gives you <em>some</em> control over the shadows, but by plugging the map into the strength input it becomes more difficult to affect the overall strength of the environment lighting (incidentally, Greg posted some great improvements to the above setup in his original article). What I really want to do is to be able to control the contrast of the lighting without affecting it’s colour, and whilst still maintaing control over it’s overall brightness. I tried a few setups with this aim in mind. This was my first one:</p>
<p><a href="/images/old/hdri_1_power.png"><img src="/images/old/hdri_1_power.png?w=950" alt="HDRI_1_Power &gt;&lt;"></a></p>
<p> This setup was my first attempt, and I was mainly concerned with making sure my math checked out so that I could get my head around future setups. Here I normalised the input to the colour node of the background shader. This gave the colour input for the background node a uniform intensity. I then extracted the value from the HDRI map and processed this separately, then used this as the input for the strength node of the background shader. By putting this input through a power (math) node first (or any other manipulation you prefer) I could control the strength and contrast of the lighting (raising it’s intensity to a higher power results in more contrast). Notably, this setup resulted in a lot more noise. I think this is because my setup messes up the Multiple Importance Sampling for the world (which I had turned on for all my renders). This convinced me that I should try and modify the input to the <em>colour</em> socket of the background node, rather than the strength, which should be kept to a uniform value, in order to avoid unnecessary noise. This setup also results in some crazy backgrounds, and glossy reflections that don’t make sense. To fix these issues I made use of the light paths node and a few mix nodes to blend in the unaltered HDRI map where appropriate, namely for glossy, transmission and camera rays. I also switched to using a Brightness&#x2F;Contrast node to affect the lighting strength. The result is the following setup:</p>
<p><a href="/images/old/hdri_1_advanced1.png"><img src="/images/old/hdri_1_advanced1.png?w=950" alt="HDRI_1_Advanced1 &gt;&lt;"></a></p>
<p> The node group of which contains the following nodes:</p>
<p><a href="/images/old/nodes.png"><img src="/images/old/nodes.png?w=950" alt="Nodes &gt;&lt;"></a></p>
<p> This node group provides a lot of flexibility whilst remaining easy to work with. You can control how much your environment affects your lightings contrast and overall brightness and adjust how this affects other aspects of your render like glossy reflections, transmission rays and the background as viewed by the camera. Here’s a few examples: Different contrast adjustments:</p>
<p><img src="/images/old/contrast.png" alt="Contrast &gt;&lt;"></p>
<p> Adjusting the look of Glossy Reflections:</p>
<p><img src="/images/old/glossymix.png" alt="GlossyMix &gt;&lt;"></p>
<p> The same effect shown above for Glossy reflections can also be controlled for transmission rays. So far it seems to work pretty well. If you give it a go I’d enjoy hearing your thoughts on it and how it worked for you. <a target="_blank" rel="noopener" href="https://dl.dropboxusercontent.com/u/180363/Hosting/HDRI_Lighting%20Control_V1.blend">You can download it here</a>. Note: The HDR map I used is not included. You can download it from <a target="_blank" rel="noopener" href="http://blendedskies.com/MediaDetails/tabid/89/ProductID/18/Default.aspx">BlendedSkies.com</a>, which is a great resource for HDR panoramas as well as other stuff like pre-tracked footage and backplates for compositing renders onto.</p>
<h1 id="Comments"><a href="#Comments" class="headerlink" title="Comments"></a>Comments</h1><p>vitos1k (Nov 07, 2013)</p>
<blockquote>
<p>But doesn’t it uses only 1 channel for  non color data(BW intensity) ? Where as for Color Data it uses 3 channels for RGB</p>
</blockquote>
<p>Ben Simonds (Nov 07, 2013)</p>
<blockquote>
<p>I’m pretty sure that the colour&#x2F;non-colour data option isn’t to important for HDR images, as they’re linear to begin with, and will be treated as such either way. It’s more relevant when using images with lower bit depths that you might not want to be assumed to be in sRGB colour space, such as masks or normal maps.</p>
</blockquote>
<p>Gumballs! | David Zerba (Nov 24, 2013)</p>
<blockquote>
<p>[&amp;#8230;] used an HDR image made by Greg Zaal for the lighting, with a node setup created by Ben Simonds. With Ben&amp;#8217;s node setup, the lighting was way more accurate and had a lot more [&amp;#8230;]</p>
</blockquote>
<p>Reynante M. Martinez (Nov 08, 2013)</p>
<blockquote>
<p>Amazing! Thanks for sharing this, Ben.  I linked this article to my original post as an update, I hope you don’t mind. :)</p>
<p>-Reyn</p>
</blockquote>
<p>Ike (Nov 13, 2013)</p>
<blockquote>
<p>Now all we need is a way to render a shadow pass from this lighting setup so it can be composited on live plates. Unfortunately Cycles currently can’t seem to render a separate shadow pass for HDR lighting.</p>
</blockquote>
<p>Ben Simonds (Nov 07, 2013)</p>
<blockquote>
<p>Nope. Colour&#x2F;Non-Colour is an assumption about colour space, not how many channels an input has. Otherwise you’d see no colour in any of the renders here!</p>
</blockquote>
<p>vitos1k (Nov 07, 2013)</p>
<blockquote>
<p>i was always wondering why everybody use “non-color data” for the color socket? why just don’t use a node with set to “Color data” for color input, and “Non-color data” for the strength. Also as i found all these contrast difference is due to .hdr which is linear and is threated as linear for values, but does it dispalyed properly(for sRGB) when rendring?<br>probably we just need to add Gamma adjustment node, and tweak ‘look’ of the texture. and adjust it’s strength and contrast to get sharp shadows, while still have correct (not darkend) glossy reflections and background gamma. That’s just my thoughts, no tests yet</p>
</blockquote>
<p>Steven (Nov 11, 2013)</p>
<blockquote>
<p>So my question would be that, how did you realized what has to be done to achieve this node setup, and how  can i learn this?</p>
</blockquote>
<p>David Zerba (Dec 03, 2013)</p>
<blockquote>
<p>Hey Ben, I’ve nominated you for the Dragon’s Loyalty Award since you blog is really helpful and inspiring to me, I’ve learned a lot from it. You can see it here :<a target="_blank" rel="noopener" href="http://davidzerba.wordpress.com/2013/12/02/dragons-loyalty-award/">http://davidzerba.wordpress.com/2013/12/02/dragons-loyalty-award/</a></p>
</blockquote>
<p>Fred Flinstone (Mar 05, 2014)</p>
<blockquote>
<p>Seems like you are burning the blues of the image.<br>Why not just crush the blacks and raise the highlights of the rendered image if it’s contrast we’re after?</p>
</blockquote>
<p>Harleynut97 (Jan 17, 2015)</p>
<blockquote>
<p>Hey Ben, Someone recommended this technique, and I realize this was originally posted almost a year ago, but let me ask 2 questions</p>
<ol>
<li><p>When I downloaded your blend file the file name said V1 in it.  But yet you are discussing V2.  Is the file you have available to download V2 or V1?</p>
</li>
<li><p>I opened this up in Blender version 2.72b official.  When I looked at your render settings both clamp direct and clamp indirect was set at 100.  I seems strange that the clamping would be at this extremely high level.  Could you confirm what it should be based on newer versions of Blender 2.72, 2.73</p>
</li>
</ol>
<p>Thanks for sharing this technique.</p>
</blockquote>
<p>mcolinp (Apr 29, 2018)</p>
<blockquote>
<p>The dropbox link is no longer working. Any chance I can download a copy of your sample blend file&#x2F;node setup?</p>
<p>I am doing research in anticipation of 2,8 and Eevee. I would like to find a way to use these effects for interactive 3D wegl output. verge3D from soft8soft.com is my current tool of choice; though I have been patiently waiting for the release of 2.8 Eevee to be able to take advantage of the better materials and environment features.</p>
</blockquote>

  <p><a class="classtest-link" href="/tags/blender/" rel="tag">blender</a>, <a class="classtest-link" href="/tags/cycles/" rel="tag">cycles</a>, <a class="classtest-link" href="/tags/hdr/" rel="tag">hdr</a>, <a class="classtest-link" href="/tags/hdri/" rel="tag">hdri</a>, <a class="classtest-link" href="/tags/lighting/" rel="tag">lighting</a>, <a class="classtest-link" href="/tags/nodes/" rel="tag">nodes</a>, <a class="classtest-link" href="/tags/resources/" rel="tag">resources</a>, <a class="classtest-link" href="/tags/shading/" rel="tag">shading</a>, <a class="classtest-link" href="/tags/tutorials/" rel="tag">tutorials</a>, <a class="classtest-link" href="/tags/world-settings/" rel="tag">world settings</a> — Nov 7, 2013</p>
  
  <br/>
  
  
  
  
    <footer>
    <p style="text-align: center;"> Ben Simonds 2023 </p>
    <ul>
        <li>
            <a href="https://www.linkedin.com/in/bensimonds/" target="_blank" style="text-decoration: none" rel="noreferrer"
                aria-label="LinkedIn">
                <svg class="icon"  width="18" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <title>LinkedIn</title>
                    <path
                        d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z" />
                </svg>
            </a>
        </li>
        <li>
            <a href="https://github.com/bensimonds" target="_blank" rel="noreferrer"
                aria-label="GitHub">
                <svg class="icon" width="18" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <title>GitHub</title>
                    <path
                        d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12" />
                </svg>
            </a>
        </li>
    </ul>
<footer>

</body>
</html>
